params {

  help  = false
  email = false
  name  = false
  plaintext_email = false

  // resourcesBaseDir: default is "resources" in the pipelines directory
  // Please change to a directory that has space for at least 60 GB of data
  // Download the resources file from https://apps-01.i-med.ac.at/resources/nextneopi/nextNEOpi_resources.tar.gz
  // and uncompress the archive into "resourcesBaseDir"
  resourcesBaseDir = "${workflow.projectDir}/resources"

  // Data: Input fastq data can be specifed by command line parameters or via batch file in csv format (recommended)
  readsTumor    = "NO_FILE" // OPTIONAL: absolute path to reads files of tumor sampled;
                            // paired-end reads "/PATH/TO/FILE/reads_tumor{1,2}.fq"
                            // single-end reads "/PPATH/TO/FILE/reads_tumor1.fq"
  readsNormal  = "NO_FILE" // OPTIONAL: absolute path to reads file of Normal sample:
                            // paired-end reads "/PATH/TO/FILE/reads_normal{1,2}.fq"
                            // single-end reads "/PATH/TO/FILE/reads_tumor1.fq"
  readsRNAseq   = "NO_FILE" // OPTIONAL: absolute path to reads file of RNAseq data:
                            // paired-end reads "/PATH/TO/FILE/reads_RNA_{1,2}.fq"
                            // single-end reads "/PATH/TO/FILE/reads_RNA_1.fq"
  customHLA     = "NO_FILE" // OPTIONAL: absolute path to user supplied HLAs
                            // format: 1 HLA type per line 4 digit (e.g. HLA-A*01:01)
  gender        = "XY"      // gender: can be Female or XX, Male or XY

  WES             = true  // if false assume WGS, attention long runtimes
  exomeCaptureKit = "sureSelectV6" // default exomeCaptureKit sure select V6, see resources.config to add more
  single_end      = false
  single_end_RNA  = false
  readLength      = 150

  trim_adapters        = false
  adapterSeq           = false // "AGATCGGAAGAG" Illumina Universal Adapter
  adapterSeqR2         = false
  adapterSeqFile       = false // fasta file with adapter seqs

  trim_adapters_RNAseq = false
  adapterSeqRNAseq     = false // "AGATCGGAAGAG"  Illumina Universal Adapter
  adapterSeqR2RNAseq   = false
  adapterSeqFileRNAseq = false // fasta file with adapter seqs

  // extra options for fastp
  fastpOpts    = ""
  fastpRNAOpts = ""

  // run controlFREEC
  controlFREEC = false

  // Panel of normals (see: https://gatk.broadinstitute.org/hc/en-us/articles/360040510131-CreateSomaticPanelOfNormals-BETA-)
  mutect2ponFile = 'NO_FILE'

  primaryCaller = "M2" // set the variant caller used as base for the hc variants.
                        // Only variants that are confirmed by any of the two confirming
                        // callers (e..g. mutect1, varscan) will be retained
                        // any of: M2 = mutect2, M1 = mutect1, VS = varscan, ST = strelka

  use_sequenza_cnvs = false

  //Directories
  tmpDir          = "/tmp/nextNEOpi/$USER"
  workDir         = "$PWD"
  outputDir       = "${workDir}/RESULTS"
  publishDirMode  = "link" // Choose between "symlink" - absolute path, "rellink" -relative path, "link " -hard link, "copy", "copyNoFollow" - copying wihtout following symlink

  tracedir         = "${params.outputDir}/pipeline_info"
  manifest.version = '1.0'

  //Software

  // ONLY if not using conda or singularity, please specify the path to the VarScan2 jar
  VARSCAN         = "/path/to/VarScan.v2.4.3.jar" // Version: 2.4.3

  // optional: specify path to mutect1 jar and the JAVA7 executable.
  // https://software.broadinstitute.org/cancer/cga/mutect_download
  // https://download.java.net/openjdk/jdk7u75/ri/jdk_ri-7u75-b13-linux-x64-18_dec_2014.tar.gz
  MUTECT1         = "/path/to/mutect-1.1.7.jar" // Version: 1.1.7
  JAVA7           = "path/to/jdk7/bin/java" // Version 1.7

  // optional but highly recommended GATK3
  // ONLY if not using conda or singularity, please specify the path to the GATK3 jar
  // https://console.cloud.google.com/storage/browser/_details/gatk-software/package-archive/gatk/GenomeAnalysisTK-3.8-1-0-gf15c1c3ef.tar.bz2
  GATK3           = "/path/to/GATK3/GenomeAnalysisTK.jar" // Version 3.8-0

  // ONLY if not using conda or singularity, please specify the path to the JAVA8 executable
  // https://download.java.net/openjdk/jdk8u41/ri/openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz
  JAVA8           = "/path/to/jdk8/bin/java" // Version 1.8

  // REQUIRED: Path to the installation directory of HLA-HD
  // Please install HLA-HD locally, you can get your own copy of HLA-HD at:
  // https://www.genome.med.kyoto-u.ac.jp/HLA-HD/
  HLAHD_DIR             = "/path/to/HLA_HD/hlahd.1.3.0"
  HLA_HD_genome_version = "hg38"

  // URL to the installation package of MIXCRC, will be installed automatically.
  MIXCR_url       = "https://github.com/milaboratory/mixcr/releases/download/v3.0.13/mixcr-3.0.13.zip"
  MIXCR           = "" // Optional: specify path to mixcr directory if already installed, will be installed automatically otherwise
  // analyze TCRs using mixcr
  TCR = true

  // MixMHC2pred
  MiXMHC2PRED_url = "https://github.com/GfellerLab/MixMHC2pred/releases/download/v1.2/MixMHC2pred-1.2.zip"
  MiXMHC2PRED     = "" // Optional: specify path to MixMHC2pred_unix directory if already installed, will be installed automatically otherwise


  // Java settings
  JAVA_Xmx = "-Xmx64G"

  // samtools memory
  STperThreadMem = "8G"

  // sambamba settings
  SB_hash_table_size = "1048576"
  SB_overflow_list_size = "1000000"
  SB_io_buffer_size = "1024"
  SB_sort_mem = "64G"


  // Filter variants (FilterMutect2Tumor): set minimum allele depth
  minAD = 5

  // Picard common options
  maxRecordsInRam = "2097152"
  maxRecordsInRamMerge = "10485760"

  // VarScan
  // Process VarscanSomatic
  min_cov                 = "10"
  min_cov_tumor           = "10"
  min_cov_normal          = "10"
  min_freq_for_hom        = "0.75"
  tumor_purity            = "0.95"
  somatic_pvalue          = "0.99"
  somatic_somaticpvalue   = "0.05"
  strand_filter           = "1"
  // Process: ProcessSomatic
  processSomatic_pvalue   = "0.05"
  max_normal_freq         = "0.05"
  min_tumor_freq          = "0.1"

  // BAMREADCOUNT
  min_map_q               = "10"
  min_base_q              = "20"


  // VEP
  vep_version             = "102.0"
  vep_assembly            = "GRCh38"
  vep_cache_version       = "102"
  vep_species             = "homo_sapiens"
  vep_options             = "--everything" // "--af --af_1kg --af_gnomad --appris --biotype --check_existing --distance 5000 --failed 1 --merged --numbers --polyphen b --protein --pubmed --regulatory --sift b --symbol --xref_refseq --tsl --gene_phenotype"


  // Scatter Count (for parallel processing over geneomi regions)
  scatter_count           = "40"


  // NeoFuse settings
  pepMin_length  = "8"
  pepMax_length  = "11"
  out_ID         = ""
  IC50_Threshold = "500"
  rank           = "2"
  conf_lvl       = "L"
  netMHCpan      = "false"

  // Process: NeoFuse_build
  build           = "false"
  buildRef        = "false"
  version         = "GRCh38"

  // pVACseq settings
  mhci_epitope_len  = "8,9,10,11"
  mhcii_epitope_len = "15,16,17,18,19,20,21,22,23,24,25" // minimum length has to be at least 15 (see pVACtools /opt/iedb/mhc_ii/mhc_II_binding.py line 246)
  baff_tools        = "NetMHCpan NetMHCIIpan"
  top_sc_metric     = "lowest"
  excl_NA           = "True"
  stability         = "False"
  min_fc            = "1"
  nrm_cov           = "5"
  tdna_cov          = "10"
  trna_cov          = "10"
  nrm_vaf           = "0.02"
  tdna_vaf          = "0.25"
  trna_vaf          = "0.25"
  exp_val           = "1.0"
  max_sup_lvl       = "1"
  pass_only         = "True"
  use_NetChop       = false
  use_NetMHCstab    = false

  // CSiN
  csin_rank      = "0.375 0.5 0.625 0.75 1.25 1.75 2"
  csin_ic50      = "500"
  csin_gene_exp  = "1"

}

// include config
includeConfig './process.config'
includeConfig './resources.config'
includeConfig './profiles.config'

timeline {
  enabled = true
  file = "${params.tracedir}/icbi/nextNEOpi_timeline.html"
}
report {
  enabled = true
  file = "${params.tracedir}/icbi/nextNEOpi_report.html"
}
trace {
  enabled = true
  file = "${params.tracedir}/icbi/nextNEOpi_trace.txt"
}
dag {
  enabled = true
  file = "${params.tracedir}/icbi/nextNEOpi_dag.svg"
}

manifest {
  name = 'icbi/nextNEOpi'
  author = 'Dietmar Rieder, Giorgios Fotakis, Francesca Finotello'
  homePage = 'https://gitlab.i-med.ac.at/icbi-lab/pipelines/nextNEOpi/'
  description = 'Nextflow pipeline for neoantigen prediction'
  mainScript = 'nextNEOpi.nf'
  nextflowVersion = '>=20.10.0'
  version = '1.0'
}


singularityTmpMount = params.tmpDir.startsWith("/tmp") ? "/tmp" : params.tmpDir
singularity {
    enabled = true
    autoMounts = true
    runOptions =  "-B " + singularityTmpMount + " -B " + params.resourcesBaseDir
}
